"use strict";
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
Object.defineProperty(exports, "__esModule", { value: true });
exports.DebugClient = void 0;
const fs = require("fs");
const constants = require("constants");
const cp = require("child_process");
const assert = require("assert");
const net = require("net");
const protocolClient_1 = require("./protocolClient");
class DebugClient extends protocolClient_1.ProtocolClient {
    /**
     * Creates a DebugClient object that provides a promise-based API to write
     * debug adapter tests.
     * A simple mocha example for setting and hitting a breakpoint in line 15 of a program 'test.js' looks like this:
     *
     * var dc;
     * setup( () => {
     *     dc = new DebugClient('node', './out/node/nodeDebug.js', 'node');
     *     return dc.start();
     * });
     * teardown( () => dc.stop() );
     *
     * test('should stop on a breakpoint', () => {
     *     return dc.hitBreakpoint({ program: 'test.js' }, 'test.js', 15);
     * });
     */
    constructor(debugAdapterRuntime, debugAdapterExecutable, debugType, spawnOptions, enableStderr) {
        super();
        this.defaultTimeout = 5000;
        this._runtime = debugAdapterRuntime;
        this._executable = debugAdapterExecutable;
        this._spawnOptions = spawnOptions;
        this._enableStderr = enableStderr;
        this._debugType = debugType;
        this._supportsConfigurationDoneRequest = false;
        if (DebugClient.CASE_INSENSITIVE_FILESYSTEM === undefined) {
            try {
                fs.accessSync(process.execPath.toLowerCase(), constants.F_OK);
                fs.accessSync(process.execPath.toUpperCase(), constants.F_OK);
                DebugClient.CASE_INSENSITIVE_FILESYSTEM = true;
            }
            catch (err) {
                DebugClient.CASE_INSENSITIVE_FILESYSTEM = false;
            }
        }
    }
    // ---- life cycle --------------------------------------------------------------------------------------------------------
    /**
     * Starts a new debug adapter and sets up communication via stdin/stdout.
     * If a port number is specified the adapter is not launched but a connection to
     * a debug adapter running in server mode is established. This is useful for debugging
     * the adapter while running tests. For this reason all timeouts are disabled in server mode.
     */
    start(port) {
        return new Promise((resolve, reject) => {
            if (typeof port === 'number') {
                this._socket = net.createConnection(port, '127.0.0.1', () => {
                    this.connect(this._socket, this._socket);
                    resolve();
                });
            }
            else {
                this._adapterProcess = cp.spawn(this._runtime, [this._executable], this._spawnOptions);
                const sanitize = (s) => s.toString().replace(/\r?\n$/mg, '');
                this._adapterProcess.stderr.on('data', (data) => {
                    if (this._enableStderr) {
                        console.log(sanitize(data));
                    }
                });
                this._adapterProcess.on('error', (err) => {
                    console.log(err);
                    reject(err);
                });
                this._adapterProcess.on('exit', (code, signal) => {
                    if (code) {
                        // done(new Error('debug adapter exit code: ' + code));
                    }
                });
                this.connect(this._adapterProcess.stdout, this._adapterProcess.stdin);
                resolve();
            }
        });
    }
    /**
     * Shutdown the debuggee and the debug adapter (or disconnect if in server mode).
     */
    stop() {
        return this.disconnectRequest().then(() => {
            this.stopAdapter();
        }).catch(() => {
            this.stopAdapter();
        });
    }
    stopAdapter() {
        if (this._adapterProcess) {
            this._adapterProcess.kill();
            this._adapterProcess = null;
        }
        if (this._socket) {
            this._socket.end();
            this._socket = null;
        }
    }
    // ---- protocol requests -------------------------------------------------------------------------------------------------
    initializeRequest(args) {
        if (!args) {
            args = {
                adapterID: this._debugType,
                linesStartAt1: true,
                columnsStartAt1: true,
                pathFormat: 'path'
            };
        }
        return this.send('initialize', args);
    }
    configurationDoneRequest(args) {
        return this.send('configurationDone', args);
    }
    launchRequest(args) {
        return this.send('launch', args);
    }
    attachRequest(args) {
        return this.send('attach', args);
    }
    restartRequest(args) {
        return this.send('restart', args);
    }
    terminateRequest(args) {
        return this.send('terminate', args);
    }
    disconnectRequest(args) {
        return this.send('disconnect', args);
    }
    setBreakpointsRequest(args) {
        return this.send('setBreakpoints', args);
    }
    setFunctionBreakpointsRequest(args) {
        return this.send('setFunctionBreakpoints', args);
    }
    setExceptionBreakpointsRequest(args) {
        return this.send('setExceptionBreakpoints', args);
    }
    dataBreakpointInfoRequest(args) {
        return this.send('dataBreakpointInfo', args);
    }
    setDataBreakpointsRequest(args) {
        return this.send('setDataBreakpoints', args);
    }
    continueRequest(args) {
        return this.send('continue', args);
    }
    nextRequest(args) {
        return this.send('next', args);
    }
    stepInRequest(args) {
        return this.send('stepIn', args);
    }
    stepOutRequest(args) {
        return this.send('stepOut', args);
    }
    stepBackRequest(args) {
        return this.send('stepBack', args);
    }
    reverseContinueRequest(args) {
        return this.send('reverseContinue', args);
    }
    restartFrameRequest(args) {
        return this.send('restartFrame', args);
    }
    gotoRequest(args) {
        return this.send('goto', args);
    }
    pauseRequest(args) {
        return this.send('pause', args);
    }
    stackTraceRequest(args) {
        return this.send('stackTrace', args);
    }
    scopesRequest(args) {
        return this.send('scopes', args);
    }
    variablesRequest(args) {
        return this.send('variables', args);
    }
    setVariableRequest(args) {
        return this.send('setVariable', args);
    }
    sourceRequest(args) {
        return this.send('source', args);
    }
    threadsRequest() {
        return this.send('threads');
    }
    modulesRequest(args) {
        return this.send('modules');
    }
    evaluateRequest(args) {
        return this.send('evaluate', args);
    }
    stepInTargetsRequest(args) {
        return this.send('stepInTargets', args);
    }
    gotoTargetsRequest(args) {
        return this.send('gotoTargets', args);
    }
    completionsRequest(args) {
        return this.send('completions', args);
    }
    exceptionInfoRequest(args) {
        return this.send('exceptionInfo', args);
    }
    customRequest(command, args) {
        return this.send(command, args);
    }
    // ---- convenience methods -----------------------------------------------------------------------------------------------
    /*
     * Returns a promise that will resolve if an event with a specific type was received within some specified time.
     * The promise will be rejected if a timeout occurs.
     */
    waitForEvent(eventType, timeout) {
        timeout = timeout || this.defaultTimeout;
        let timeoutHandler;
        return new Promise((resolve, reject) => {
            this.once(eventType, event => {
                clearTimeout(timeoutHandler);
                resolve(event);
            });
            if (!this._socket) { // no timeouts if debugging the tests
                timeoutHandler = setTimeout(() => {
                    reject(new Error(`no event '${eventType}' received after ${timeout} ms`));
                }, timeout);
            }
        });
    }
    /*
     * Returns a promise that will resolve if an 'initialized' event was received within some specified time
     * and a subsequent 'configurationDone' request was successfully executed.
     * The promise will be rejected if a timeout occurs or if the 'configurationDone' request fails.
     */
    configurationSequence() {
        return this.waitForEvent('initialized').then(event => {
            return this.configurationDone();
        });
    }
    /**
     * Returns a promise that will resolve if a 'initialize' and a 'launch' request were successful.
     */
    launch(launchArgs) {
        return this.initializeRequest().then(response => {
            if (response.body && response.body.supportsConfigurationDoneRequest) {
                this._supportsConfigurationDoneRequest = true;
            }
            return this.launchRequest(launchArgs);
        });
    }
    configurationDone() {
        if (this._supportsConfigurationDoneRequest) {
            return this.configurationDoneRequest();
        }
        else {
            // if debug adapter doesn't support the configurationDoneRequest we have to send the setExceptionBreakpointsRequest.
            return this.setExceptionBreakpointsRequest({ filters: ['all'] });
        }
    }
    /*
     * Returns a promise that will resolve if a 'stopped' event was received within some specified time
     * and the event's reason and line number was asserted.
     * The promise will be rejected if a timeout occurs, the assertions fail, or if the 'stackTrace' request fails.
     */
    assertStoppedLocation(reason, expected) {
        return this.waitForEvent('stopped').then(event => {
            assert.equal(event.body.reason, reason);
            return this.stackTraceRequest({
                threadId: event.body.threadId
            });
        }).then(response => {
            const frame = response.body.stackFrames[0];
            if (typeof expected.path === 'string' || expected.path instanceof RegExp) {
                this.assertPath(frame.source.path, expected.path, 'stopped location: path mismatch');
            }
            if (typeof expected.line === 'number') {
                assert.equal(frame.line, expected.line, 'stopped location: line mismatch');
            }
            if (typeof expected.column === 'number') {
                assert.equal(frame.column, expected.column, 'stopped location: column mismatch');
            }
            return response;
        });
    }
    assertPartialLocationsEqual(locA, locB) {
        if (locA.path) {
            this.assertPath(locA.path, locB.path, 'breakpoint verification mismatch: path');
        }
        if (typeof locA.line === 'number') {
            assert.equal(locA.line, locB.line, 'breakpoint verification mismatch: line');
        }
        if (typeof locB.column === 'number' && typeof locA.column === 'number') {
            assert.equal(locA.column, locB.column, 'breakpoint verification mismatch: column');
        }
    }
    /*
     * Returns a promise that will resolve if enough output events with the given category have been received
     * and the concatenated data match the expected data.
     * The promise will be rejected as soon as the received data cannot match the expected data or if a timeout occurs.
     */
    assertOutput(category, expected, timeout) {
        timeout = timeout || this.defaultTimeout;
        return new Promise((resolve, reject) => {
            let output = '';
            let timeoutHandler;
            this.on('output', event => {
                const e = event;
                if (e.body.category === category) {
                    output += e.body.output;
                    if (output.indexOf(expected) === 0) {
                        clearTimeout(timeoutHandler);
                        resolve(event);
                    }
                    else if (expected.indexOf(output) !== 0) {
                        const sanitize = (s) => s.toString().replace(/\r/mg, '\\r').replace(/\n/mg, '\\n');
                        reject(new Error(`received data '${sanitize(output)}' is not a prefix of the expected data '${sanitize(expected)}'`));
                    }
                }
            });
            if (!this._socket) { // no timeouts if debugging the tests
                timeoutHandler = setTimeout(() => {
                    reject(new Error(`not enough output data received after ${timeout} ms`));
                }, timeout);
            }
        });
    }
    assertPath(path, expected, message) {
        if (expected instanceof RegExp) {
            assert.ok(expected.test(path), message);
        }
        else {
            if (DebugClient.CASE_INSENSITIVE_FILESYSTEM) {
                if (typeof path === 'string') {
                    path = path.toLowerCase();
                }
                if (typeof expected === 'string') {
                    expected = expected.toLowerCase();
                }
            }
            assert.equal(path, expected, message);
        }
    }
    // ---- scenarios ---------------------------------------------------------------------------------------------------------
    /**
     * Returns a promise that will resolve if a configurable breakpoint has been hit within some time
     * and the event's reason and line number was asserted.
     * The promise will be rejected if a timeout occurs, the assertions fail, or if the requests fails.
     */
    hitBreakpoint(launchArgs, location, expectedStopLocation, expectedBPLocation) {
        return Promise.all([
            this.waitForEvent('initialized').then(event => {
                return this.setBreakpointsRequest({
                    lines: [location.line],
                    breakpoints: [{ line: location.line, column: location.column }],
                    source: { path: location.path }
                });
            }).then(response => {
                const bp = response.body.breakpoints[0];
                const verified = (typeof location.verified === 'boolean') ? location.verified : true;
                assert.equal(bp.verified, verified, 'breakpoint verification mismatch: verified');
                const actualLocation = {
                    column: bp.column,
                    line: bp.line,
                    path: bp.source && bp.source.path
                };
                this.assertPartialLocationsEqual(actualLocation, expectedBPLocation || location);
                return this.configurationDone();
            }),
            this.launch(launchArgs),
            this.assertStoppedLocation('breakpoint', expectedStopLocation || location)
        ]);
    }
}
exports.DebugClient = DebugClient;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVidWdDbGllbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZGVidWdDbGllbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Z0dBR2dHOzs7QUFFaEcseUJBQTBCO0FBQzFCLHVDQUF3QztBQUN4QyxvQ0FBcUM7QUFDckMsaUNBQWtDO0FBQ2xDLDJCQUE0QjtBQUU1QixxREFBZ0Q7QUFnQmhELE1BQWEsV0FBWSxTQUFRLCtCQUFjO0lBZ0I5Qzs7Ozs7Ozs7Ozs7Ozs7O09BZUc7SUFDSCxZQUFZLG1CQUEyQixFQUFFLHNCQUE4QixFQUFFLFNBQWlCLEVBQUUsWUFBOEIsRUFBRSxZQUFzQjtRQUNqSixLQUFLLEVBQUUsQ0FBQztRQW5CRixtQkFBYyxHQUFHLElBQUksQ0FBQztRQW9CNUIsSUFBSSxDQUFDLFFBQVEsR0FBRyxtQkFBbUIsQ0FBQztRQUNwQyxJQUFJLENBQUMsV0FBVyxHQUFHLHNCQUFzQixDQUFDO1FBQzFDLElBQUksQ0FBQyxhQUFhLEdBQUcsWUFBWSxDQUFDO1FBQ2xDLElBQUksQ0FBQyxhQUFhLEdBQUcsWUFBWSxDQUFDO1FBQ2xDLElBQUksQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFDO1FBQzVCLElBQUksQ0FBQyxpQ0FBaUMsR0FBRyxLQUFLLENBQUM7UUFFL0MsSUFBSSxXQUFXLENBQUMsMkJBQTJCLEtBQUssU0FBUyxFQUFFO1lBQzFELElBQUk7Z0JBQ0gsRUFBRSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxFQUFFLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDOUQsRUFBRSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxFQUFFLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDOUQsV0FBVyxDQUFDLDJCQUEyQixHQUFHLElBQUksQ0FBQzthQUMvQztZQUFDLE9BQU8sR0FBRyxFQUFFO2dCQUNiLFdBQVcsQ0FB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Z0JBRWpGLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDakMsQ0FBQyxDQUFDO1lBRUYsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUM7WUFFdkIsSUFBSSxDQUFDLHFCQUFxQixDQUFDLFlBQVksRUFBRSxvQkFBb0IsSUFBSSxRQUFRLENBQUM7U0FFMUUsQ0FBQyxDQUFDO0lBQ0osQ0FBQztDQUNEO0FBamNELGtDQWljQyIsInNvdXJjZXNDb250ZW50IjpbIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5pbXBvcnQgZnMgPSByZXF1aXJlKCdmcycpO1xuaW1wb3J0IGNvbnN0YW50cyA9IHJlcXVpcmUoJ2NvbnN0YW50cycpO1xuaW1wb3J0IGNwID0gcmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpO1xuaW1wb3J0IGFzc2VydCA9IHJlcXVpcmUoJ2Fzc2VydCcpO1xuaW1wb3J0IG5ldCA9IHJlcXVpcmUoJ25ldCcpO1xuaW1wb3J0IHtEZWJ1Z1Byb3RvY29sfSBmcm9tICd2c2NvZGUtZGVidWdwcm90b2NvbCc7XG5pbXBvcnQge1Byb3RvY29sQ2xpZW50fSBmcm9tICcuL3Byb3RvY29sQ2xpZW50JztcblxuZXhwb3J0IGludGVyZmFjZSBJTG9jYXRpb24ge1xuXHRwYXRoOiBzdHJpbmc7XG5cdGxpbmU6IG51bWJlcjtcblx0Y29sdW1uPzogbnVtYmVyO1xuXHR2ZXJpZmllZD86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVBhcnRpYWxMb2NhdGlvbiB7XG5cdHBhdGg/OiBzdHJpbmc7XG5cdGxpbmU/OiBudW1iZXI7XG5cdGNvbHVtbj86IG51bWJlcjtcblx0dmVyaWZpZWQ/OiBib29sZWFuO1xufVxuXG5leHBvcnQgY2xhc3MgRGVidWdDbGllbnQgZXh0ZW5kcyBQcm90b2NvbENsaWVudCB7XG5cblx0cHJpdmF0ZSBzdGF0aWMgQ0FTRV9JTlNFTlNJVElWRV9GSUxFU1lTVEVNIDogYm9vbGVhbjtcblxuXHRwcml2YXRlIF9ydW50aW1lOiBzdHJpbmc7XG5cdHByaXZhdGUgX2V4ZWN1dGFibGU6IHN0cmluZztcblx0cHJpdmF0ZSBfYWRhcHRlclByb2Nlc3M6IGNwLkNoaWxkUHJvY2Vzcztcblx0cHJpdmF0ZSBfc3Bhd25PcHRpb25zOiBjcC5TcGF3bk9wdGlvbnM7XG5cdHByaXZhdGUgX2VuYWJsZVN0ZGVycjogYm9vbGVhbjtcblx0cHJpdmF0ZSBfZGVidWdUeXBlOiBzdHJpbmc7XG5cdHByaXZhdGUgX3NvY2tldDogbmV0LlNvY2tldDtcblxuXHRwcml2YXRlIF9zdXBwb3J0c0NvbmZpZ3VyYXRpb25Eb25lUmVxdWVzdDogYm9vbGVhbjtcblxuXHRwdWJsaWMgZGVmYXVsdFRpbWVvdXQgPSA1MDAwO1xuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGEgRGVidWdDbGllbnQgb2JqZWN0IHRoYXQgcHJvdmlkZXMgYSBwcm9taXNlLWJhc2VkIEFQSSB0byB3cml0ZVxuXHQgKiBkZWJ1ZyBhZGFwdGVyIHRlc3RzLlxuXHQgKiBBIHNpbXBsZSBtb2NoYSBleGFtcGxlIGZvciBzZXR0aW5nIGFuZCBoaXR0aW5nIGEgYnJlYWtwb2ludCBpbiBsaW5lIDE1IG9mIGEgcHJvZ3JhbSAndGVzdC5qcycgbG9va3MgbGlrZSB0aGlzOlxuXHQgKlxuXHQgKiB2YXIgZGM7XG5cdCAqIHNldHVwKCAoKSA9PiB7XG5cdCAqICAgICBkYyA9IG5ldyBEZWJ1Z0NsaWVudCgnbm9kZScsICcuL291dC9ub2RlL25vZGVEZWJ1Zy5qcycsICdub2RlJyk7XG5cdCAqICAgICByZXR1cm4gZGMuc3RhcnQoKTtcblx0ICogfSk7XG5cdCAqIHRlYXJkb3duKCAoKSA9PiBkYy5zdG9wKCkgKTtcblx0ICpcblx0ICogdGVzdCgnc2hvdWxkIHN0b3Agb24gYSBicmVha3BvaW50JywgKCkgPT4ge1xuXHQgKiAgICAgcmV0dXJuIGRjLmhpdEJyZWFrcG9pbnQoeyBwcm9ncmFtOiAndGVzdC5qcycgfSwgJ3Rlc3QuanMnLCAxNSk7XG5cdCAqIH0pO1xuXHQgKi9cblx0Y29uc3RydWN0b3IoZGVidWdBZGFwdGVyUnVudGltZTogc3RyaW5nLCBkZWJ1Z0FkYXB0ZXJFeGVjdXRhYmxlOiBzdHJpbmcsIGRlYnVnVHlwZTogc3RyaW5nLCBzcGF3bk9wdGlvbnM/OiBjcC5TcGF3bk9wdGlvbnMsIGVuYWJsZVN0ZGVycj86IGJvb2xlYW4pIHtcblx0XHRzdXBlcigpO1xuXHRcdHRoaXMuX3J1bnRpbWUgPSBkZWJ1Z0FkYXB0ZXJSdW50aW1lO1xuXHRcdHRoaXMuX2V4ZWN1dGFibGUgPSBkZWJ1Z0FkYXB0ZXJFeGVjdXRhYmxlO1xuXHRcdHRoaXMuX3NwYXduT3B0aW9ucyA9IHNwYXduT3B0aW9ucztcblx0XHR0aGlzLl9lbmFibGVTdGRlcnIgPSBlbmFibGVTdGRlcnI7XG5cdFx0dGhpcy5fZGVidWdUeXBlID0gZGVidWdUeXBlO1xuXHRcdHRoaXMuX3N1cHBvcnRzQ29uZmlndXJhdGlvbkRvbmVSZXF1ZXN0ID0gZmFsc2U7XG5cblx0XHRpZiAoRGVidWdDbGllbnQuQ0FTRV9JTlNFTlNJVElWRV9GSUxFU1lTVEVNID09PSB1bmRlZmluZWQpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdGZzLmFjY2Vzc1N5bmMocHJvY2Vzcy5leGVjUGF0aC50b0xvd2VyQ2FzZSgpLCBjb25zdGFudHMuRl9PSyk7XG5cdFx0XHRcdGZzLmFjY2Vzc1N5bmMocHJvY2Vzcy5leGVjUGF0aC50b1VwcGVyQ2FzZSgpLCBjb25zdGFudHMuRl9PSyk7XG5cdFx0XHRcdERlYnVnQ2xpZW50LkNBU0VfSU5TRU5TSVRJVkVfRklMRVNZU1RFTSA9IHRydWU7XG5cdFx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdFx0RGVidWdDbGllbnQuQ0FTRV9JTlNFTlNJVElWRV9GSUxFU1lTVEVNID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0Ly8gLS0tLSBsaWZlIGN5Y2xlIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cblx0LyoqXG5cdCAqIFN0YXJ0cyBhIG5ldyBkZWJ1ZyBhZGFwdGVyIGFuZCBzZXRzIHVwIGNvbW11bmljYXRpb24gdmlhIHN0ZGluL3N0ZG91dC5cblx0ICogSWYgYSBwb3J0IG51bWJlciBpcyBzcGVjaWZpZWQgdGhlIGFkYXB0ZXIgaXMgbm90IGxhdW5jaGVkIGJ1dCBhIGNvbm5lY3Rpb24gdG9cblx0ICogYSBkZWJ1ZyBhZGFwdGVyIHJ1bm5pbmcgaW4gc2VydmVyIG1vZGUgaXMgZXN0YWJsaXNoZWQuIFRoaXMgaXMgdXNlZnVsIGZvciBkZWJ1Z2dpbmdcblx0ICogdGhlIGFkYXB0ZXIgd2hpbGUgcnVubmluZyB0ZXN0cy4gRm9yIHRoaXMgcmVhc29uIGFsbCB0aW1lb3V0cyBhcmUgZGlzYWJsZWQgaW4gc2VydmVyIG1vZGUuXG5cdCAqL1xuXHRwdWJsaWMgc3RhcnQocG9ydD86IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlPHZvaWQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcblx0XHRcdGlmICh0eXBlb2YgcG9ydCA9PT0gJ251bWJlcicpIHtcblx0XHRcdFx0dGhpcy5fc29ja2V0ID0gbmV0LmNyZWF0ZUNvbm5lY3Rpb24ocG9ydCwgJzEyNy4wLjAuMScsICgpID0+IHtcblx0XHRcdFx0XHR0aGlzLmNvbm5lY3QodGhpcy5fc29ja2V0LCB0aGlzLl9zb2NrZXQpO1xuXHRcdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLl9hZGFwdGVyUHJvY2VzcyA9IGNwLnNwYXduKHRoaXMuX3J1bnRpbWUsIFsgdGhpcy5fZXhlY3V0YWJsZSBdLCB0aGlzLl9zcGF3bk9wdGlvbnMpO1xuXHRcdFx0XHRjb25zdCBzYW5pdGl6ZSA9IChzOiBzdHJpbmcpID0+IHMudG9TdHJpbmcoKS5yZXBsYWNlKC9cXHI/XFxuJC9tZywgJycpO1xuXHRcdFx0XHR0aGlzLl9hZGFwdGVyUHJvY2Vzcy5zdGRlcnIub24oJ2RhdGEnLCAoZGF0YTogc3RyaW5nKSA9PiB7XG5cdFx0XHRcdFx0aWYgKHRoaXMuX2VuYWJsZVN0ZGVycikge1xuXHRcdFx0XHRcdFx0Y29uc29sZS5sb2coc2FuaXRpemUoZGF0YSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0dGhpcy5fYWRhcHRlclByb2Nlc3Mub24oJ2Vycm9yJywgKGVycikgPT4ge1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKGVycik7XG5cdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHR0aGlzLl9hZGFwdGVyUHJvY2Vzcy5vbignZXhpdCcsIChjb2RlOiBudW1iZXIsIHNpZ25hbDogc3RyaW5nKSA9PiB7XG5cdFx0XHRcdFx0aWYgKGNvZGUpIHtcblx0XHRcdFx0XHRcdC8vIGRvbmUobmV3IEVycm9yKCdkZWJ1ZyBhZGFwdGVyIGV4aXQgY29kZTogJyArIGNvZGUpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHRoaXMuY29ubmVjdCh0aGlzLl9hZGFwdGVyUHJvY2Vzcy5zdGRvdXQsIHRoaXMuX2FkYXB0ZXJQcm9jZXNzLnN0ZGluKTtcblx0XHRcdFx0cmVzb2x2ZSgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG5cdCAqIFNodXRkb3duIHRoZSBkZWJ1Z2dlZSBhbmQgdGhlIGRlYnVnIGFkYXB0ZXIgKG9yIGRpc2Nvbm5lY3QgaWYgaW4gc2VydmVyIG1vZGUpLlxuXHQgKi9cblx0cHVibGljIHN0b3AoKTogUHJvbWlzZTx2b2lkPiB7XG5cblx0XHRyZXR1cm4gdGhpcy5kaXNjb25uZWN0UmVxdWVzdCgpLnRoZW4oKCkgPT4ge1xuXHRcdFx0dGhpcy5zdG9wQWRhcHRlcigpO1xuXHRcdH0pLmNhdGNoKCgpID0+IHtcblx0XHRcdHRoaXMuc3RvcEFkYXB0ZXIoKTtcblx0XHR9KTtcblx0fVxuXG5cdHByaXZhdGUgc3RvcEFkYXB0ZXIoKSB7XG5cdFx0aWYgKHRoaXMuX2FkYXB0ZXJQcm9jZXNzKSB7XG5cdFx0XHR0aGlzLl9hZGFwdGVyUHJvY2Vzcy5raWxsKCk7XG5cdFx0XHR0aGlzLl9hZGFwdGVyUHJvY2VzcyA9IG51bGw7XG5cdFx0fVxuXHRcdGlmICh0aGlzLl9zb2NrZXQpIHtcblx0XHRcdHRoaXMuX3NvY2tldC5lbmQoKTtcblx0XHRcdHRoaXMuX3NvY2tldCA9IG51bGw7XG5cdFx0fVxuXHR9XG5cblx0Ly8gLS0tLSBwcm90b2NvbCByZXF1ZXN0cyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cblx0cHVibGljIGluaXRpYWxpemVSZXF1ZXN0KGFyZ3M/OiBEZWJ1Z1Byb3RvY29sLkluaXRpYWxpemVSZXF1ZXN0QXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLkluaXRpYWxpemVSZXNwb25zZT4ge1xuXHRcdGlmICghYXJncykge1xuXHRcdFx0YXJncyA9IHtcblx0XHRcdFx0YWRhcHRlcklEOiB0aGlzLl9kZWJ1Z1R5cGUsXG5cdFx0XHRcdGxpbmVzU3RhcnRBdDE6IHRydWUsXG5cdFx0XHRcdGNvbHVtbnNTdGFydEF0MTogdHJ1ZSxcblx0XHRcdFx0cGF0aEZvcm1hdDogJ3BhdGgnXG5cdFx0XHR9O1xuXHRcdH1cblx0XHRyZXR1cm4gdGhpcy5zZW5kKCdpbml0aWFsaXplJywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgY29uZmlndXJhdGlvbkRvbmVSZXF1ZXN0KGFyZ3M/OiBEZWJ1Z1Byb3RvY29sLkNvbmZpZ3VyYXRpb25Eb25lQXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLkNvbmZpZ3VyYXRpb25Eb25lUmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCdjb25maWd1cmF0aW9uRG9uZScsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIGxhdW5jaFJlcXVlc3QoYXJnczogRGVidWdQcm90b2NvbC5MYXVuY2hSZXF1ZXN0QXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLkxhdW5jaFJlc3BvbnNlPiB7XG5cdFx0cmV0dXJuIHRoaXMuc2VuZCgnbGF1bmNoJywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgYXR0YWNoUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLkF0dGFjaFJlcXVlc3RBcmd1bWVudHMpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuQXR0YWNoUmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCdhdHRhY2gnLCBhcmdzKTtcblx0fVxuXG5cdHB1YmxpYyByZXN0YXJ0UmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLlJlc3RhcnRBcmd1bWVudHMpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuUmVzdGFydFJlc3BvbnNlPiB7XG5cdFx0cmV0dXJuIHRoaXMuc2VuZCgncmVzdGFydCcsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIHRlcm1pbmF0ZVJlcXVlc3QoYXJncz86IERlYnVnUHJvdG9jb2wuVGVybWluYXRlQXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLlRlcm1pbmF0ZVJlc3BvbnNlPiB7XG5cdFx0cmV0dXJuIHRoaXMuc2VuZCgndGVybWluYXRlJywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgZGlzY29ubmVjdFJlcXVlc3QoYXJncz86IERlYnVnUHJvdG9jb2wuRGlzY29ubmVjdEFyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5EaXNjb25uZWN0UmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCdkaXNjb25uZWN0JywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgc2V0QnJlYWtwb2ludHNSZXF1ZXN0KGFyZ3M6IERlYnVnUHJvdG9jb2wuU2V0QnJlYWtwb2ludHNBcmd1bWVudHMpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuU2V0QnJlYWtwb2ludHNSZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ3NldEJyZWFrcG9pbnRzJywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgc2V0RnVuY3Rpb25CcmVha3BvaW50c1JlcXVlc3QoYXJnczogRGVidWdQcm90b2NvbC5TZXRGdW5jdGlvbkJyZWFrcG9pbnRzQXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLlNldEZ1bmN0aW9uQnJlYWtwb2ludHNSZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ3NldEZ1bmN0aW9uQnJlYWtwb2ludHMnLCBhcmdzKTtcblx0fVxuXG5cdHB1YmxpYyBzZXRFeGNlcHRpb25CcmVha3BvaW50c1JlcXVlc3QoYXJnczogRGVidWdQcm90b2NvbC5TZXRFeGNlcHRpb25CcmVha3BvaW50c0FyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5TZXRFeGNlcHRpb25CcmVha3BvaW50c1Jlc3BvbnNlPiB7XG5cdFx0cmV0dXJuIHRoaXMuc2VuZCgnc2V0RXhjZXB0aW9uQnJlYWtwb2ludHMnLCBhcmdzKTtcblx0fVxuXG5cdHB1YmxpYyBkYXRhQnJlYWtwb2ludEluZm9SZXF1ZXN0KGFyZ3M6IERlYnVnUHJvdG9jb2wuRGF0YUJyZWFrcG9pbnRJbmZvQXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLkRhdGFCcmVha3BvaW50SW5mb1Jlc3BvbnNlPiB7XG5cdFx0cmV0dXJuIHRoaXMuc2VuZCgnZGF0YUJyZWFrcG9pbnRJbmZvJywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgc2V0RGF0YUJyZWFrcG9pbnRzUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLlNldERhdGFCcmVha3BvaW50c0FyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5TZXREYXRhQnJlYWtwb2ludHNSZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ3NldERhdGFCcmVha3BvaW50cycsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIGNvbnRpbnVlUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLkNvbnRpbnVlQXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLkNvbnRpbnVlUmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCdjb250aW51ZScsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIG5leHRSZXF1ZXN0KGFyZ3M6IERlYnVnUHJvdG9jb2wuTmV4dEFyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5OZXh0UmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCduZXh0JywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgc3RlcEluUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLlN0ZXBJbkFyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5TdGVwSW5SZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ3N0ZXBJbicsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIHN0ZXBPdXRSZXF1ZXN0KGFyZ3M6IERlYnVnUHJvdG9jb2wuU3RlcE91dEFyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5TdGVwT3V0UmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCdzdGVwT3V0JywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgc3RlcEJhY2tSZXF1ZXN0KGFyZ3M6IERlYnVnUHJvdG9jb2wuU3RlcEJhY2tBcmd1bWVudHMpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuU3RlcEJhY2tSZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ3N0ZXBCYWNrJywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgcmV2ZXJzZUNvbnRpbnVlUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLlJldmVyc2VDb250aW51ZUFyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5SZXZlcnNlQ29udGludWVSZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ3JldmVyc2VDb250aW51ZScsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIHJlc3RhcnRGcmFtZVJlcXVlc3QoYXJnczogRGVidWdQcm90b2NvbC5SZXN0YXJ0RnJhbWVBcmd1bWVudHMpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuUmVzdGFydEZyYW1lUmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCdyZXN0YXJ0RnJhbWUnLCBhcmdzKTtcblx0fVxuXG5cdHB1YmxpYyBnb3RvUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLkdvdG9Bcmd1bWVudHMpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuR290b1Jlc3BvbnNlPiB7XG5cdFx0cmV0dXJuIHRoaXMuc2VuZCgnZ290bycsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIHBhdXNlUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLlBhdXNlQXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLlBhdXNlUmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCdwYXVzZScsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIHN0YWNrVHJhY2VSZXF1ZXN0KGFyZ3M6IERlYnVnUHJvdG9jb2wuU3RhY2tUcmFjZUFyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5TdGFja1RyYWNlUmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCdzdGFja1RyYWNlJywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgc2NvcGVzUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLlNjb3Blc0FyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5TY29wZXNSZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ3Njb3BlcycsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIHZhcmlhYmxlc1JlcXVlc3QoYXJnczogRGVidWdQcm90b2NvbC5WYXJpYWJsZXNBcmd1bWVudHMpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuVmFyaWFibGVzUmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCd2YXJpYWJsZXMnLCBhcmdzKTtcblx0fVxuXG5cdHB1YmxpYyBzZXRWYXJpYWJsZVJlcXVlc3QoYXJnczogRGVidWdQcm90b2NvbC5TZXRWYXJpYWJsZUFyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5TZXRWYXJpYWJsZVJlc3BvbnNlPiB7XG5cdFx0cmV0dXJuIHRoaXMuc2VuZCgnc2V0VmFyaWFibGUnLCBhcmdzKTtcblx0fVxuXG5cdHB1YmxpYyBzb3VyY2VSZXF1ZXN0KGFyZ3M6IERlYnVnUHJvdG9jb2wuU291cmNlQXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLlNvdXJjZVJlc3BvbnNlPiB7XG5cdFx0cmV0dXJuIHRoaXMuc2VuZCgnc291cmNlJywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgdGhyZWFkc1JlcXVlc3QoKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLlRocmVhZHNSZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ3RocmVhZHMnKTtcblx0fVxuXG5cdHB1YmxpYyBtb2R1bGVzUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLk1vZHVsZXNBcmd1bWVudHMpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuTW9kdWxlc1Jlc3BvbnNlPiB7XG5cdFx0cmV0dXJuIHRoaXMuc2VuZCgnbW9kdWxlcycpO1xuXHR9XG5cblx0cHVibGljIGV2YWx1YXRlUmVxdWVzdChhcmdzOiBEZWJ1Z1Byb3RvY29sLkV2YWx1YXRlQXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLkV2YWx1YXRlUmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCdldmFsdWF0ZScsIGFyZ3MpO1xuXHR9XG5cblx0cHVibGljIHN0ZXBJblRhcmdldHNSZXF1ZXN0KGFyZ3M6IERlYnVnUHJvdG9jb2wuU3RlcEluVGFyZ2V0c0FyZ3VtZW50cyk6IFByb21pc2U8RGVidWdQcm90b2NvbC5TdGVwSW5UYXJnZXRzUmVzcG9uc2U+IHtcblx0XHRyZXR1cm4gdGhpcy5zZW5kKCdzdGVwSW5UYXJnZXRzJywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgZ290b1RhcmdldHNSZXF1ZXN0KGFyZ3M6IERlYnVnUHJvdG9jb2wuR290b1RhcmdldHNBcmd1bWVudHMpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuR290b1RhcmdldHNSZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ2dvdG9UYXJnZXRzJywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgY29tcGxldGlvbnNSZXF1ZXN0KGFyZ3M6IERlYnVnUHJvdG9jb2wuQ29tcGxldGlvbnNBcmd1bWVudHMpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuQ29tcGxldGlvbnNSZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ2NvbXBsZXRpb25zJywgYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgZXhjZXB0aW9uSW5mb1JlcXVlc3QoYXJnczogRGVidWdQcm90b2NvbC5FeGNlcHRpb25JbmZvQXJndW1lbnRzKTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLkV4Y2VwdGlvbkluZm9SZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoJ2V4Y2VwdGlvbkluZm8nLCBhcmdzKTtcblx0fVxuXG5cdHB1YmxpYyBjdXN0b21SZXF1ZXN0KGNvbW1hbmQ6IHN0cmluZywgYXJncz86IGFueSk6IFByb21pc2U8RGVidWdQcm90b2NvbC5SZXNwb25zZT4ge1xuXHRcdHJldHVybiB0aGlzLnNlbmQoY29tbWFuZCwgYXJncyk7XG5cdH1cblxuXHQvLyAtLS0tIGNvbnZlbmllbmNlIG1ldGhvZHMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuXHQvKlxuXHQgKiBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHdpbGwgcmVzb2x2ZSBpZiBhbiBldmVudCB3aXRoIGEgc3BlY2lmaWMgdHlwZSB3YXMgcmVjZWl2ZWQgd2l0aGluIHNvbWUgc3BlY2lmaWVkIHRpbWUuXG5cdCAqIFRoZSBwcm9taXNlIHdpbGwgYmUgcmVqZWN0ZWQgaWYgYSB0aW1lb3V0IG9jY3Vycy5cblx0ICovXG5cdHB1YmxpYyB3YWl0Rm9yRXZlbnQoZXZlbnRUeXBlOiBzdHJpbmcsIHRpbWVvdXQ/OiBudW1iZXIpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuRXZlbnQ+IHtcblxuXHRcdHRpbWVvdXQgPSB0aW1lb3V0IHx8IHRoaXMuZGVmYXVsdFRpbWVvdXQ7XG5cdFx0bGV0IHRpbWVvdXRIYW5kbGVyOiBhbnk7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXHRcdFx0dGhpcy5vbmNlKGV2ZW50VHlwZSwgZXZlbnQgPT4ge1xuXHRcdFx0XHRjbGVhclRpbWVvdXQodGltZW91dEhhbmRsZXIpO1xuXHRcdFx0XHRyZXNvbHZlKGV2ZW50KTtcblx0XHRcdH0pO1xuXHRcdFx0aWYgKCF0aGlzLl9zb2NrZXQpIHtcdC8vIG5vIHRpbWVvdXRzIGlmIGRlYnVnZ2luZyB0aGUgdGVzdHNcblx0XHRcdFx0dGltZW91dEhhbmRsZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0XHRyZWplY3QobmV3IEVycm9yKGBubyBldmVudCAnJHtldmVudFR5cGV9JyByZWNlaXZlZCBhZnRlciAke3RpbWVvdXR9IG1zYCkpO1xuXHRcdFx0XHR9LCB0aW1lb3V0KTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8qXG5cdCAqIFJldHVybnMgYSBwcm9taXNlIHRoYXQgd2lsbCByZXNvbHZlIGlmIGFuICdpbml0aWFsaXplZCcgZXZlbnQgd2FzIHJlY2VpdmVkIHdpdGhpbiBzb21lIHNwZWNpZmllZCB0aW1lXG5cdCAqIGFuZCBhIHN1YnNlcXVlbnQgJ2NvbmZpZ3VyYXRpb25Eb25lJyByZXF1ZXN0IHdhcyBzdWNjZXNzZnVsbHkgZXhlY3V0ZWQuXG5cdCAqIFRoZSBwcm9taXNlIHdpbGwgYmUgcmVqZWN0ZWQgaWYgYSB0aW1lb3V0IG9jY3VycyBvciBpZiB0aGUgJ2NvbmZpZ3VyYXRpb25Eb25lJyByZXF1ZXN0IGZhaWxzLlxuXHQgKi9cblx0cHVibGljIGNvbmZpZ3VyYXRpb25TZXF1ZW5jZSgpOiBQcm9taXNlPGFueT4ge1xuXG5cdFx0cmV0dXJuIHRoaXMud2FpdEZvckV2ZW50KCdpbml0aWFsaXplZCcpLnRoZW4oZXZlbnQgPT4ge1xuXHRcdFx0cmV0dXJuIHRoaXMuY29uZmlndXJhdGlvbkRvbmUoKTtcblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHdpbGwgcmVzb2x2ZSBpZiBhICdpbml0aWFsaXplJyBhbmQgYSAnbGF1bmNoJyByZXF1ZXN0IHdlcmUgc3VjY2Vzc2Z1bC5cblx0ICovXG5cdHB1YmxpYyBsYXVuY2gobGF1bmNoQXJnczogYW55KTogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLkxhdW5jaFJlc3BvbnNlPiB7XG5cblx0XHRyZXR1cm4gdGhpcy5pbml0aWFsaXplUmVxdWVzdCgpLnRoZW4ocmVzcG9uc2UgPT4ge1xuXHRcdFx0aWYgKHJlc3BvbnNlLmJvZHkgJiYgcmVzcG9uc2UuYm9keS5zdXBwb3J0c0NvbmZpZ3VyYXRpb25Eb25lUmVxdWVzdCkge1xuXHRcdFx0XHR0aGlzLl9zdXBwb3J0c0NvbmZpZ3VyYXRpb25Eb25lUmVxdWVzdCA9IHRydWU7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcy5sYXVuY2hSZXF1ZXN0KGxhdW5jaEFyZ3MpO1xuXHRcdH0pO1xuXHR9XG5cblx0cHJpdmF0ZSBjb25maWd1cmF0aW9uRG9uZSgpIDogUHJvbWlzZTxEZWJ1Z1Byb3RvY29sLlJlc3BvbnNlPiB7XG5cdFx0aWYgKHRoaXMuX3N1cHBvcnRzQ29uZmlndXJhdGlvbkRvbmVSZXF1ZXN0KSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5jb25maWd1cmF0aW9uRG9uZVJlcXVlc3QoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gaWYgZGVidWcgYWRhcHRlciBkb2Vzbid0IHN1cHBvcnQgdGhlIGNvbmZpZ3VyYXRpb25Eb25lUmVxdWVzdCB3ZSBoYXZlIHRvIHNlbmQgdGhlIHNldEV4Y2VwdGlvbkJyZWFrcG9pbnRzUmVxdWVzdC5cblx0XHRcdHJldHVybiB0aGlzLnNldEV4Y2VwdGlvbkJyZWFrcG9pbnRzUmVxdWVzdCh7IGZpbHRlcnM6IFsgJ2FsbCcgXSB9KTtcblx0XHR9XG5cdH1cblxuXHQvKlxuXHQgKiBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHdpbGwgcmVzb2x2ZSBpZiBhICdzdG9wcGVkJyBldmVudCB3YXMgcmVjZWl2ZWQgd2l0aGluIHNvbWUgc3BlY2lmaWVkIHRpbWVcblx0ICogYW5kIHRoZSBldmVudCdzIHJlYXNvbiBhbmQgbGluZSBudW1iZXIgd2FzIGFzc2VydGVkLlxuXHQgKiBUaGUgcHJvbWlzZSB3aWxsIGJlIHJlamVjdGVkIGlmIGEgdGltZW91dCBvY2N1cnMsIHRoZSBhc3NlcnRpb25zIGZhaWwsIG9yIGlmIHRoZSAnc3RhY2tUcmFjZScgcmVxdWVzdCBmYWlscy5cblx0ICovXG5cdHB1YmxpYyBhc3NlcnRTdG9wcGVkTG9jYXRpb24ocmVhc29uOiBzdHJpbmcsIGV4cGVjdGVkOiB7IHBhdGg/OiBzdHJpbmcgfCBSZWdFeHAsIGxpbmU/OiBudW1iZXIsIGNvbHVtbj86IG51bWJlciB9ICkgOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuU3RhY2tUcmFjZVJlc3BvbnNlPiB7XG5cblx0XHRyZXR1cm4gdGhpcy53YWl0Rm9yRXZlbnQoJ3N0b3BwZWQnKS50aGVuKGV2ZW50ID0+IHtcblx0XHRcdGFzc2VydC5lcXVhbChldmVudC5ib2R5LnJlYXNvbiwgcmVhc29uKTtcblx0XHRcdHJldHVybiB0aGlzLnN0YWNrVHJhY2VSZXF1ZXN0KHtcblx0XHRcdFx0dGhyZWFkSWQ6IGV2ZW50LmJvZHkudGhyZWFkSWRcblx0XHRcdH0pO1xuXHRcdH0pLnRoZW4ocmVzcG9uc2UgPT4ge1xuXHRcdFx0Y29uc3QgZnJhbWUgPSByZXNwb25zZS5ib2R5LnN0YWNrRnJhbWVzWzBdO1xuXHRcdFx0aWYgKHR5cGVvZiBleHBlY3RlZC5wYXRoID09PSAnc3RyaW5nJyB8fCBleHBlY3RlZC5wYXRoIGluc3RhbmNlb2YgUmVnRXhwKSB7XG5cdFx0XHRcdHRoaXMuYXNzZXJ0UGF0aChmcmFtZS5zb3VyY2UucGF0aCwgZXhwZWN0ZWQucGF0aCwgJ3N0b3BwZWQgbG9jYXRpb246IHBhdGggbWlzbWF0Y2gnKTtcblx0XHRcdH1cblx0XHRcdGlmICh0eXBlb2YgZXhwZWN0ZWQubGluZSA9PT0gJ251bWJlcicpIHtcblx0XHRcdFx0YXNzZXJ0LmVxdWFsKGZyYW1lLmxpbmUsIGV4cGVjdGVkLmxpbmUsICdzdG9wcGVkIGxvY2F0aW9uOiBsaW5lIG1pc21hdGNoJyk7XG5cdFx0XHR9XG5cdFx0XHRpZiAodHlwZW9mIGV4cGVjdGVkLmNvbHVtbiA9PT0gJ251bWJlcicpIHtcblx0XHRcdFx0YXNzZXJ0LmVxdWFsKGZyYW1lLmNvbHVtbiwgZXhwZWN0ZWQuY29sdW1uLCAnc3RvcHBlZCBsb2NhdGlvbjogY29sdW1uIG1pc21hdGNoJyk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcmVzcG9uc2U7XG5cdFx0fSk7XG5cdH1cblxuXHRwcml2YXRlIGFzc2VydFBhcnRpYWxMb2NhdGlvbnNFcXVhbChsb2NBOiBJUGFydGlhbExvY2F0aW9uLCBsb2NCOiBJUGFydGlhbExvY2F0aW9uKTogdm9pZCB7XG5cdFx0aWYgKGxvY0EucGF0aCkge1xuXHRcdFx0dGhpcy5hc3NlcnRQYXRoKGxvY0EucGF0aCwgbG9jQi5wYXRoLCAnYnJlYWtwb2ludCB2ZXJpZmljYXRpb24gbWlzbWF0Y2g6IHBhdGgnKTtcblx0XHR9XG5cdFx0aWYgKHR5cGVvZiBsb2NBLmxpbmUgPT09ICdudW1iZXInKSB7XG5cdFx0XHRhc3NlcnQuZXF1YWwobG9jQS5saW5lLCBsb2NCLmxpbmUsICdicmVha3BvaW50IHZlcmlmaWNhdGlvbiBtaXNtYXRjaDogbGluZScpO1xuXHRcdH1cblx0XHRpZiAodHlwZW9mIGxvY0IuY29sdW1uID09PSAnbnVtYmVyJyAmJiB0eXBlb2YgbG9jQS5jb2x1bW4gPT09ICdudW1iZXInKSB7XG5cdFx0XHRhc3NlcnQuZXF1YWwobG9jQS5jb2x1bW4sIGxvY0IuY29sdW1uLCAnYnJlYWtwb2ludCB2ZXJpZmljYXRpb24gbWlzbWF0Y2g6IGNvbHVtbicpO1xuXHRcdH1cblx0fVxuXG5cdC8qXG5cdCAqIFJldHVybnMgYSBwcm9taXNlIHRoYXQgd2lsbCByZXNvbHZlIGlmIGVub3VnaCBvdXRwdXQgZXZlbnRzIHdpdGggdGhlIGdpdmVuIGNhdGVnb3J5IGhhdmUgYmVlbiByZWNlaXZlZFxuXHQgKiBhbmQgdGhlIGNvbmNhdGVuYXRlZCBkYXRhIG1hdGNoIHRoZSBleHBlY3RlZCBkYXRhLlxuXHQgKiBUaGUgcHJvbWlzZSB3aWxsIGJlIHJlamVjdGVkIGFzIHNvb24gYXMgdGhlIHJlY2VpdmVkIGRhdGEgY2Fubm90IG1hdGNoIHRoZSBleHBlY3RlZCBkYXRhIG9yIGlmIGEgdGltZW91dCBvY2N1cnMuXG5cdCAqL1xuXHRwdWJsaWMgYXNzZXJ0T3V0cHV0KGNhdGVnb3J5OiBzdHJpbmcsIGV4cGVjdGVkOiBzdHJpbmcsIHRpbWVvdXQ/OiBudW1iZXIpOiBQcm9taXNlPERlYnVnUHJvdG9jb2wuRXZlbnQ+IHtcblxuXHRcdHRpbWVvdXQgPSB0aW1lb3V0IHx8IHRoaXMuZGVmYXVsdFRpbWVvdXQ7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXHRcdFx0bGV0IG91dHB1dCA9ICcnO1xuXHRcdFx0bGV0IHRpbWVvdXRIYW5kbGVyOiBhbnk7XG5cdFx0XHR0aGlzLm9uKCdvdXRwdXQnLCBldmVudCA9PiB7XG5cdFx0XHRcdGNvbnN0IGUgPSA8RGVidWdQcm90b2NvbC5PdXRwdXRFdmVudD4gZXZlbnQ7XG5cdFx0XHRcdGlmIChlLmJvZHkuY2F0ZWdvcnkgPT09IGNhdGVnb3J5KSB7XG5cdFx0XHRcdFx0b3V0cHV0ICs9IGUuYm9keS5vdXRwdXQ7XG5cdFx0XHRcdFx0aWYgKG91dHB1dC5pbmRleE9mKGV4cGVjdGVkKSA9PT0gMCkge1xuXHRcdFx0XHRcdFx0Y2xlYXJUaW1lb3V0KHRpbWVvdXRIYW5kbGVyKTtcblx0XHRcdFx0XHRcdHJlc29sdmUoZXZlbnQpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAoZXhwZWN0ZWQuaW5kZXhPZihvdXRwdXQpICE9PSAwKSB7XG5cdFx0XHRcdFx0XHRjb25zdCBzYW5pdGl6ZSA9IChzOiBzdHJpbmcpID0+IHMudG9TdHJpbmcoKS5yZXBsYWNlKC9cXHIvbWcsICdcXFxccicpLnJlcGxhY2UoL1xcbi9tZywgJ1xcXFxuJyk7XG5cdFx0XHRcdFx0XHRyZWplY3QobmV3IEVycm9yKGByZWNlaXZlZCBkYXRhICcke3Nhbml0aXplKG91dHB1dCl9JyBpcyBub3QgYSBwcmVmaXggb2YgdGhlIGV4cGVjdGVkIGRhdGEgJyR7c2FuaXRpemUoZXhwZWN0ZWQpfSdgKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdGlmICghdGhpcy5fc29ja2V0KSB7XHQvLyBubyB0aW1lb3V0cyBpZiBkZWJ1Z2dpbmcgdGhlIHRlc3RzXG5cdFx0XHRcdHRpbWVvdXRIYW5kbGVyID0gc2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdFx0cmVqZWN0KG5ldyBFcnJvcihgbm90IGVub3VnaCBvdXRwdXQgZGF0YSByZWNlaXZlZCBhZnRlciAke3RpbWVvdXR9IG1zYCkpO1xuXHRcdFx0XHR9LCB0aW1lb3V0KTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdHB1YmxpYyBhc3NlcnRQYXRoKHBhdGg6IHN0cmluZywgZXhwZWN0ZWQ6IHN0cmluZyB8IFJlZ0V4cCwgbWVzc2FnZT86IHN0cmluZykge1xuXG5cdFx0aWYgKGV4cGVjdGVkIGluc3RhbmNlb2YgUmVnRXhwKSB7XG5cdFx0XHRhc3NlcnQub2soKDxSZWdFeHA+ZXhwZWN0ZWQpLnRlc3QocGF0aCksIG1lc3NhZ2UpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRpZiAoRGVidWdDbGllbnQuQ0FTRV9JTlNFTlNJVElWRV9GSUxFU1lTVEVNKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YgcGF0aCA9PT0gJ3N0cmluZycpIHtcblx0XHRcdFx0XHRwYXRoID0gcGF0aC50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmICh0eXBlb2YgZXhwZWN0ZWQgPT09ICdzdHJpbmcnKSB7XG5cdFx0XHRcdFx0ZXhwZWN0ZWQgPSAoPHN0cmluZz5leHBlY3RlZCkudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0YXNzZXJ0LmVxdWFsKHBhdGgsIGV4cGVjdGVkLCBtZXNzYWdlKTtcblx0XHR9XG5cdH1cblxuXHQvLyAtLS0tIHNjZW5hcmlvcyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuXHQvKipcblx0ICogUmV0dXJucyBhIHByb21pc2UgdGhhdCB3aWxsIHJlc29sdmUgaWYgYSBjb25maWd1cmFibGUgYnJlYWtwb2ludCBoYXMgYmVlbiBoaXQgd2l0aGluIHNvbWUgdGltZVxuXHQgKiBhbmQgdGhlIGV2ZW50J3MgcmVhc29uIGFuZCBsaW5lIG51bWJlciB3YXMgYXNzZXJ0ZWQuXG5cdCAqIFRoZSBwcm9taXNlIHdpbGwgYmUgcmVqZWN0ZWQgaWYgYSB0aW1lb3V0IG9jY3VycywgdGhlIGFzc2VydGlvbnMgZmFpbCwgb3IgaWYgdGhlIHJlcXVlc3RzIGZhaWxzLlxuXHQgKi9cblx0cHVibGljIGhpdEJyZWFrcG9pbnQobGF1bmNoQXJnczogYW55LCBsb2NhdGlvbjogSUxvY2F0aW9uLCBleHBlY3RlZFN0b3BMb2NhdGlvbj86IElQYXJ0aWFsTG9jYXRpb24sIGV4cGVjdGVkQlBMb2NhdGlvbj86IElQYXJ0aWFsTG9jYXRpb24pIDogUHJvbWlzZTxhbnk+IHtcblxuXHRcdHJldHVybiBQcm9taXNlLmFsbChbXG5cblx0XHRcdHRoaXMud2FpdEZvckV2ZW50KCdpbml0aWFsaXplZCcpLnRoZW4oZXZlbnQgPT4ge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zZXRCcmVha3BvaW50c1JlcXVlc3Qoe1xuXHRcdFx0XHRcdGxpbmVzOiBbIGxvY2F0aW9uLmxpbmUgXSxcblx0XHRcdFx0XHRicmVha3BvaW50czogWyB7IGxpbmU6IGxvY2F0aW9uLmxpbmUsIGNvbHVtbjogbG9jYXRpb24uY29sdW1uIH0gXSxcblx0XHRcdFx0XHRzb3VyY2U6IHsgcGF0aDogbG9jYXRpb24ucGF0aCB9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSkudGhlbihyZXNwb25zZSA9PiB7XG5cblx0XHRcdFx0Y29uc3QgYnAgPSByZXNwb25zZS5ib2R5LmJyZWFrcG9pbnRzWzBdO1xuXG5cdFx0XHRcdGNvbnN0IHZlcmlmaWVkID0gKHR5cGVvZiBsb2NhdGlvbi52ZXJpZmllZCA9PT0gJ2Jvb2xlYW4nKSA/IGxvY2F0aW9uLnZlcmlmaWVkIDogdHJ1ZTtcblx0XHRcdFx0YXNzZXJ0LmVxdWFsKGJwLnZlcmlmaWVkLCB2ZXJpZmllZCwgJ2JyZWFrcG9pbnQgdmVyaWZpY2F0aW9uIG1pc21hdGNoOiB2ZXJpZmllZCcpO1xuXG5cdFx0XHRcdGNvbnN0IGFjdHVhbExvY2F0aW9uOiBJTG9jYXRpb24gPSB7XG5cdFx0XHRcdFx0Y29sdW1uOiBicC5jb2x1bW4sXG5cdFx0XHRcdFx0bGluZTogYnAubGluZSxcblx0XHRcdFx0XHRwYXRoOiBicC5zb3VyY2UgJiYgYnAuc291cmNlLnBhdGhcblx0XHRcdFx0fTtcblx0XHRcdFx0dGhpcy5hc3NlcnRQYXJ0aWFsTG9jYXRpb25zRXF1YWwoYWN0dWFsTG9jYXRpb24sIGV4cGVjdGVkQlBMb2NhdGlvbiB8fCBsb2NhdGlvbik7XG5cblx0XHRcdFx0cmV0dXJuIHRoaXMuY29uZmlndXJhdGlvbkRvbmUoKTtcblx0XHRcdH0pLFxuXG5cdFx0XHR0aGlzLmxhdW5jaChsYXVuY2hBcmdzKSxcblxuXHRcdFx0dGhpcy5hc3NlcnRTdG9wcGVkTG9jYXRpb24oJ2JyZWFrcG9pbnQnLCBleHBlY3RlZFN0b3BMb2NhdGlvbiB8fCBsb2NhdGlvbilcblxuXHRcdF0pO1xuXHR9XG59XG4iXX0=